# 安全防护

## 安全的重要性

安全是软件开发中不可忽视的重要方面。一个存在安全漏洞的应用，可能导致用户数据泄露、系统被攻击、业务受损等严重后果。在 Vibe Coding 过程中，我们需要时刻保持安全意识，确保生成的代码是安全的。

## 安全基本原则

### 最小权限原则

程序应该只请求完成功能所必需的最小权限。不过度授权，不过度请求。

### 防御性编程

假设所有用户输入都是不可信的。所有输入都需要验证。所有操作都需要授权检查。

### 纵深防御

不要依赖单一的安全措施。使用多层安全防护。即使一层被攻破，还有其他层可以保护。

## 常见安全威胁

### 注入攻击

**SQL 注入**：攻击者通过输入数据注入 SQL 语句。防护：使用参数化查询。输入验证。

**XSS（跨站脚本）**：攻击者注入恶意脚本代码。防护：输出编码。内容安全策略。输入验证。

**命令注入**：攻击者注入系统命令。防护：避免使用用户输入构建命令。使用安全的 API。

### 认证授权问题

**弱密码**：用户使用容易被猜到的密码。防护：强制密码复杂度要求。实现登录尝试限制。

**会话管理不当**：会话令牌被窃取或劫持。防护：使用安全的会话令牌。实现会话过期机制。

**权限提升**：用户获得超出其权限的访问。防护：实现基于角色的访问控制。每次操作都检查权限。

### 数据泄露

**敏感数据暴露**：敏感数据没有适当保护。防护：加密敏感数据。使用 HTTPS。正确配置访问控制。

**日志泄露**：敏感信息写入日志。防护：日志中不包含敏感数据。日志访问受限。

## 前端安全

### XSS 防护

**输出编码**：在将用户输入渲染到页面时进行编码。使用框架的自动转义。

**内容安全策略（CSP）**：配置 CSP 头部，限制资源加载。只允许信任的来源。

**避免危险操作**：避免使用 innerHTML、eval 等危险操作。

### 认证安全

**令牌安全**：使用 JWT 或其他安全令牌。令牌存储在安全的位置（不是 localStorage）。实现令牌过期和刷新机制。

**密码处理**：在前端不存储明文密码。使用安全的传输（HTTPS）。

### 依赖安全

**及时更新**：保持依赖库的最新版本。使用自动化工具检测漏洞。

**审查依赖**：了解使用的每个依赖。避免使用有已知漏洞的库。

## 后端安全

### 输入验证

**白名单验证**：定义可接受的输入格式。只接受符合规则的输入。

**类型检查**：验证数据类型。处理类型转换错误。

**长度限制**：限制输入长度。防止缓冲区溢出。

### 数据库安全

**参数化查询**：所有数据库操作使用参数化查询。避免 SQL 注入。

**最小权限**：数据库用户只授予必要的权限。避免使用 root 用户。

**加密存储**：敏感数据加密存储。密钥安全管理。

### API 安全

**认证**：API 使用安全的认证机制。令牌验证每个请求。

**授权**：检查用户是否有权执行操作。实现细粒度的权限控制。

**限流**：限制 API 调用频率。防止 DoS 攻击。

## 运维安全

### 环境安全

**环境变量**：敏感配置使用环境变量。不要将密钥提交到代码仓库。

**安全配置**：服务器安全配置。数据库安全配置。防火墙配置。

**访问控制**：限制服务器访问。最小化开放端口。

### 日志与监控

**安全日志**：记录安全相关的事件。登录尝试、权限变更等。

**异常检测**：监控异常行为。自动告警可疑活动。

**审计跟踪**：保留完整的审计日志。便于事后分析和追溯。

### 备份与恢复

**定期备份**：定期备份数据和配置。测试备份恢复流程。

**离线备份**：保持离线或异地备份。防止勒索软件。

## 安全开发流程

### 需求阶段

在需求阶段考虑安全：识别安全需求。评估安全风险。制定安全策略。

### 设计阶段

在设计阶段考虑安全：威胁建模。安全架构设计。安全设计评审。

### 开发阶段

在开发阶段考虑安全：遵循安全编码规范。进行代码安全审查。使用安全工具检测。

### 测试阶段

在测试阶段考虑安全：安全测试。渗透测试。漏洞扫描。

### 运维阶段

在运维阶段考虑安全：安全监控。漏洞修补。应急响应。

## Vibe Coding 中的安全实践

### 向 AI 提出安全要求

在请求代码时明确安全要求：

```
请编写用户认证 API，要求：
1. 使用 bcrypt 加密密码，不存储明文密码
2. 所有输入进行验证和清理
3. 使用参数化查询防止 SQL 注入
4. 实现登录尝试限制，防止暴力破解
5. 返回的错误信息不泄露敏感细节
6. JWT Token 设置合理的过期时间
```

### 安全审查

审查 AI 生成的代码，关注安全问题：输入是否得到验证。输出是否正确编码。敏感数据是否保护。权限是否正确检查。

### 安全测试

对生成的功能进行安全测试：尝试注入攻击。测试权限控制。检查敏感数据保护。

## 安全工具与资源

### 安全扫描工具

**依赖检查**：Snyk、npm audit、Dependabot。

**静态分析**：ESLint 安全规则、SonarQube。

**动态测试**：OWASP ZAP、Burp Suite。

### 安全资源

**OWASP**：Web 应用安全最佳实践。

**安全编码规范**：各语言的官方安全指南。

**漏洞数据库**：CVE、NVD。
