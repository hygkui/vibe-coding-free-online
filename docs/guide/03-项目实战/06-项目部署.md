# 项目部署

## 部署概述

项目部署是将开发完成的代码发布到服务器，让用户可以访问的过程。对于 Vibe Coding 学习者来说，部署是项目完整性的重要一环，也是将作品分享给更多人的必经之路。

不同类型的项目有不同的部署方式。本章将介绍常见项目的部署方法和最佳实践。

## 静态网站部署

### 静态网站的特点

静态网站是指只有 HTML、CSS、JavaScript 等静态文件的网站，没有服务端逻辑。这类网站部署简单、成本低、速度快。

### 部署平台选择

**GitHub Pages** 是最流行的静态网站托管服务。免费、支持自定义域名、与 Git 版本控制无缝集成。适合个人项目、文档网站、博客等。

**Vercel** 是现代静态网站部署的首选。部署简单、自动预览部署、支持 Serverless Functions。适合 Next.js、React、Vue 等项目。

**Netlify** 提供丰富的功能，包括表单处理、分支部署、边缘函数等。免费版足够大多数个人项目使用。

### 部署步骤

以 GitHub Pages 为例：

第一步，创建 GitHub 仓库，将代码推送到仓库。

第二步，在仓库设置中找到 GitHub Pages 选项。

第三步，选择部署的分支（通常是 main 或 gh-pages）。

第四步，等待部署完成，访问生成的网址。

### 自定义域名

在 GitHub Pages 设置中可以配置自定义域名：购买域名后，在域名服务商处添加 DNS 记录。在 GitHub Pages 设置中填写自定义域名。启用 HTTPS（GitHub Pages 自动提供）。

## 前端应用部署

### 构建生产版本

前端框架项目需要先构建生产版本：运行 npm run build 或类似命令。构建产物通常在 dist 或 build 目录中。

构建会优化代码：压缩和混淆代码。提取 CSS 到单独文件。优化图片和其他资源。代码分割和懒加载。

### 部署配置

前端应用通常需要配置：API 基础路径，如果 API 不在同源。静态资源路径，确保正确加载。构建时环境变量。

### 部署到云服务器

对于需要更多控制的情况，可以部署到云服务器：购买云服务器（如阿里云、腾讯云、AWS EC2）。安装 Nginx 或其他 Web 服务器。配置 Nginx 反向代理。构建并上传代码。配置 HTTPS（使用 Let's Encrypt）。

## 后端服务部署

### 运行环境

后端服务需要运行环境：Node.js 应用需要安装 Node.js 环境。Python 应用需要安装 Python 环境。

建议使用进程管理器：PM2 for Node.js，提供进程守护、自动重启、负载均衡。Gunicorn for Python。

### 部署方式

**直接部署**：在服务器上直接运行应用。适合小型应用和开发测试。

**Docker 部署**：将应用打包成 Docker 镜像。便于移植和管理。适合生产环境。

**Serverless 部署**：将函数部署到云平台。按调用付费，自动扩缩容。适合轻量级应用。

### 配置文件管理

使用环境变量管理配置：数据库连接字符串、API 密钥、端口号等敏感和可变配置不应硬编码在代码中。使用 .env 文件本地开发，使用环境变量在服务器配置。

## 数据库部署

### 数据库选择

根据项目需求选择数据库：小型项目可以用 SQLite，无需单独服务器。中小型项目可以用 MySQL 或 PostgreSQL。云服务提供托管数据库。高并发场景可能需要 Redis 等缓存数据库。

### 云数据库

使用云数据库服务可以简化运维：阿里云 RDS、腾讯云 RDS、AWS RDS。提供自动备份、高可用、弹性扩展。

### 数据迁移

项目迁移时需要迁移数据库：备份源数据库。恢复数据到目标数据库。更新应用配置中的数据库连接。

## 域名与 HTTPS

### 域名购买

购买域名的渠道：国内域名商（阿里云、腾讯云）。国外域名商（Namecheap、GoDaddy）。

选择域名时注意：简短易记、与项目相关、容易拼写。

### DNS 配置

DNS 将域名解析到服务器 IP：A 记录直接将域名指向 IP 地址。CNAME 记录将域名指向另一个域名。

常见的 DNS 配置：在域名商控制台添加 A 记录或 CNAME 记录。TTL 设置影响 DNS 缓存时间。

### HTTPS 配置

HTTPS 是现代网站的标准配置。获取免费证书：Let's Encrypt 提供免费证书。云平台通常提供证书管理服务。

配置 HTTPS：下载证书文件（Nginx 用 .pem 和 .key）。配置 Web 服务器使用证书。强制跳转 HTTP 到 HTTPS。

## 持续集成与部署

### CI/CD 概念

CI（持续集成）是指频繁将代码合并到主干。CD（持续部署）是指自动将代码部署到生产环境。

### 工具选择

**GitHub Actions** 是 GitHub 提供的 CI/CD 服务。与 GitHub 无缝集成，免费额度足够个人项目使用。

**GitLab CI** 是 GitLab 自带的 CI/CD 功能。使用 .gitlab-ci.yml 配置文件。

**Jenkins** 是功能强大的开源 CI/CD 服务器。自托管，需要服务器资源。

### 自动部署配置

以 GitHub Actions 为例，自动部署静态网站的配置：

```yaml
name: Deploy to GitHub Pages
on:
  push:
    branches: [main]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18
      - name: Install dependencies
        run: npm ci
      - name: Build
        run: npm run build
      - name: Deploy
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist
```

## 监控与运维

### 错误监控

生产环境需要监控错误：前端错误可以使用 Sentry、LogRocket 等服务。后端错误记录到日志文件或日志服务。

### 性能监控

监控应用性能：页面加载时间（可以使用 Google Analytics）。API 响应时间。服务器资源使用率。

### 日志管理

集中管理日志：使用 ELK Stack（Elasticsearch、Logstash、Kibana）。使用云平台的日志服务。定期归档和清理日志。

### 备份策略

定期备份数据和代码：数据库自动备份。代码有 Git 历史。配置文件纳入版本控制。

## 部署最佳实践

### 环境分离

使用不同的环境：开发环境，本地开发。测试环境，集成测试。生产环境，面向用户。

每个环境使用独立的配置和资源。

### 优雅降级

当系统出现问题时，提供优雅降级：显示友好的错误页面。缓存关键数据。关闭非核心功能。

### 灾难恢复

制定灾难恢复计划：定期测试恢复流程。记录恢复步骤。保持恢复介质最新。

### 成本控制

注意云服务成本：选择合适规格的资源。使用预留实例或节省计划。及时释放不再使用的资源。
